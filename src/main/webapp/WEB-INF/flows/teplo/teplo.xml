<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd"
      start-state="teplo">





      <var name="selection" class="ru.javabegin.training.vkt7.object.Selection"/>
      <var name="searchCriteria_cust" class="ru.javabegin.training.vkt7.object.SearchCriteria_cust"/>
      <var name="searchCriteria_data" class="ru.javabegin.training.vkt7.object_data.SearchCriteria_data"/>



      <view-state id="teplo" view="teplo.xhtml">
            <on-render>
                  <evaluate expression="facade_customer.findAllCustomers()" result="viewScope.cu"  />
                  <evaluate expression="searchCriteria_cust.data_Q()" result="viewScope.dateQ"  />
            </on-render>


            <transition on="customer_process" to="addCustomer">
            </transition>

            <transition on="modem_process" to="modem">
            </transition>
            <transition on="data_process" to="data">
            </transition>
            <transition on="reports_process" to="reports">
            </transition>

            <transition on="data_tv7_process" to="data_tv7">
            </transition>

            <transition on="recover" to="recover">
            </transition>


            <transition on="update_q">
                  <evaluate expression="facade_data.update_Q_current_all_OK()" />

            </transition>
           <!-- <transition on="recover">
                  <evaluate expression="facade_data.recover()" />

            </transition>-->



      </view-state>

      <subflow-state id="addCustomer" subflow="teplo/customer_process">
            <transition on="customer_ready" to="endState" />
      </subflow-state>

      <subflow-state id="modem" subflow="teplo/modem_process">
            <transition on="modem_ready" to="endState" />
      </subflow-state>
      <subflow-state id="data" subflow="teplo/data_process">
            <transition on="data_ready" to="endState" />
      </subflow-state>
      <subflow-state id="reports" subflow="teplo/reports_process">
            <transition on="reports_ready" to="endState" />
      </subflow-state>
      <subflow-state id="data_tv7" subflow="teplo/data_tv7_process">
            <transition on="data_tv7_ready" to="endState" />
      </subflow-state>

      <subflow-state id="recover" subflow="teplo/recover_process">
            <transition on="recover_ready" to="endState" />
      </subflow-state>





      <end-state id="endState"  view="flowRedirect:teplo"/>


      <global-transitions> <!-- Глобальный переход в случае отмены заказа -->
            <transition on="cancel" to="endState" />
      </global-transitions>








</flow>
