<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd"
      start-state="data_tv7_process">

      <var name="selectionTv7" class="ru.javabegin.training.tv7.object_data_tv7.SelectionTv7"/>
      <!--//<var name="searchCriteriaTv7" class="ru.javabegin.training.tv7.object_data_tv7.SearchCriteriaTv7"/>-->
    <var name="markersView" class="ru.javabegin.training.vkt7.Maps.MarkersView"/>

      <view-state id="data_tv7_process" view="customer_tv7_d_select.xhtml" >
            <on-entry>
                  <evaluate expression="facadeTv7.findTv7Customers()" result="viewScope.cu"  />
            </on-entry>


            <transition on="day_month" to="archive_action"/>
          <transition on="total" to="total_action"/>

          <transition on="selectTv7_ALL_xls" to="action_selectTv7_ALL_xls"/>



      </view-state>


    <action-state id="archive_action">


        <evaluate expression="facadeTv7.checkSelectedData()" />

        <transition on="yes" to="archive" />
        <transition on="no" to="data_tv7_process" >
            <set name="flashScope.message" value="'selectCustomer'"/>
        </transition>


    </action-state>



    <view-state id="archive" view="tv7_archive.xhtml">
    <on-entry>
        <evaluate expression="facadeTv7.findTv7Day()" result="viewScope.archive" />
    </on-entry>
        <transition on="action_selectTv7" to="action_selectTv7"/>
        <transition on="action_selectTv7_xls" to="action_selectTv7_xls"/>


        <transition on="back" to="data_tv7_process"/>
    </view-state>



    <action-state id="total_action">


        <evaluate expression="facadeTv7.checkSelectedData()" />

        <transition on="yes" to="total" />
        <transition on="no" to="data_tv7_process" >
            <set name="flashScope.message" value="'selectCustomer'"/>
        </transition>


    </action-state>



    <view-state id="total" view="tv7_total.xhtml">

        <on-entry>
            <evaluate expression="facadeTv7.findTv7Total()" result="viewScope.total" />
        </on-entry>
        <transition on="back" to="data_tv7_process"/>
        <transition on="action_selectTv7T" to="action_selectTv7T"/>


    </view-state>


    <action-state id="action_selectTv7T">


        <evaluate expression="facadeTv7.checkDateOfDateToSelected()" />

        <transition on="yes" to="total_getDate" />
        <transition on="no" to="total" >
            <set name="flashScope.message" value="'Select Date for Report'"/>
        </transition>


    </action-state>




    <action-state id="action_selectTv7">


        <evaluate expression="facadeTv7.checkDateOfDateToSelected()" />

        <transition on="yes" to="archive_getDate" />
        <transition on="no" to="total" >
            <set name="flashScope.message" value="'Select Date for Report'"/>
        </transition>


    </action-state>

    <action-state id="action_selectTv7_xls">


        <evaluate expression="facadeTv7.checkDateOfDateToSelected()" />

        <transition on="yes" to="archive" >
            <evaluate expression="facadeTv7.getExcel_archive()" />
            <set name="flashScope.message1" value="'Файл формируется'"/>
        </transition>

        <transition on="no" to="archive" >
            <set name="flashScope.message" value="'Не выбраны даты'"/>
        </transition>


    </action-state>




    <action-state id="action_selectTv7_ALL_xls">

        <evaluate expression="facadeTv7.getExcel_ALL_archive()" />

        <transition to="archive" >

            <set name="flashScope.message1" value="'Файлы формируются в формате Excel в директории c:/demo/ТВ7'"/>
        </transition>



    </action-state>



    <view-state id="total_getDate" view="tv7_total_getDate.xhtml" >


    <on-entry>
        <!--<evaluate expression="facade_data.getTotal_current_column()" result="flashScope.t_c_col"/>-->
        <evaluate expression="facadeTv7.getSelectedByData()" result="viewScope.total" />
    </on-entry>

    <transition on="back" to="total"/>
    <!--<transition on="next" to="measurements"/>-->

</view-state>




    <view-state id="archive_getDate" view="tv7_archive_getDate.xhtml" >


        <on-entry>
            <!--<evaluate expression="facade_data.getTotal_current_column()" result="flashScope.t_c_col"/>-->
            <evaluate expression="facadeTv7.getSelectedByData_Archive()" result="viewScope.archive" />
        </on-entry>

        <transition on="back" to="archive"/>
        <!--<transition on="next" to="measurements"/>-->

    </view-state>










    <end-state id="data_tv7_ready"  />


      <global-transitions> <!-- Глобальный переход в случае отмены заказа -->

            <transition on="cancel" to="data_tv7_ready" />
      </global-transitions>







</flow>
